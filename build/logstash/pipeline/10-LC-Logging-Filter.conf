filter {
	if [type] == "logging" {
		mutate {
			add_field => { 
				"MachineName" => "%{[Properties][MachineName]}"
				"AppName" => "%{[Properties][AppName]}"
				"ThreadId" => "%{[Properties][ThreadId]}"
			}
			remove_field => ["@version", "[Properties][MachineName]", "[Properties][AppName]", "[Properties][ThreadId]"]	
		}
		
		if [Properties][response]{
		
			mutate {
				add_field => { 
					"ResponseData" => "%{[Properties][response]}"
				}
			}
			
			json  {
				source => "ResponseData"
				target => "item"
				add_field => { "RequestHttpMethod" => "%{[item][HttpMethod]}" }
				add_field => { "RequestComponentType" => "%{[item][ComponentType]}" }
				add_field => { "RequestElapsedTime" => "%{[item][ElapsedTime]}" }
				add_field => { "RequestType" => "%{[item][RequestType]}" }
				add_field => { "RemoteIp" => "%{[item][RemoteIp]}" }
				add_field => { "RequestSequence" => "%{[item][Sequence]}" }
				add_field => { "RequestDto" => "%{[item][RequestDto]}" }
				add_field => { "RequestLength" => "%{[item][RequestLength]}" }
				add_field => { "ResponseDto" => "%{[item][ResponseDto]}" }
				add_field => { "ResponseLength" => "%{[item][ResponseLength]}" }
			}
			
			if [item][Session]{
				
				mutate {
					add_field => { "SubscriberId" => "%{[item][Session][SubscriberId]}" }
					add_field => { "SubscriberDisplayName" => "%{[item][Session][SubscriberDisplayName]}" }
					add_field => { "Username" => "%{[item][Session][Username]}" }
					add_field => { "AccountCode" => "%{[item][Session][AccountCode]}" }
					add_field => { "AccountId" => "%{[item][Session][AccountId]}" }
					add_field => { "StoreIdentifier" => "%{[item][Session][StoreIdentifier]}" }
					add_field => { "DeviceUID" => "%{[item][Session][DeviceUID]}" }
					add_field => { "SubscriberType" => "%{[item][Session][SubscriberType]}" }
					add_field => { "Clearances" => "%{[item][Session][Clearances]}" }
					add_field => { "DkVersion" => "%{[item][Session][DkVersion]}" }
					
				}
				
				if("Administration|0" in [item][Session][Clearances]){
					mutate { 
						add_field => { "RequestIsBackend" => true }
						convert => { "RequestIsBackend" => "boolean" }
					}
				}	
			}
			
			if "_jsonparsefailure" not in [tags] {
				mutate {remove_field => [ "Properties"]}
			}
			
			mutate {
				remove_field => [ "ResponseData", "item"]
				convert => { "RequestSequence" => "integer" }
				convert => { "RequestElapsedTime" => "integer" }			
				convert => { "RequestLength" => "integer" }			
				convert => { "ResponseLength" => "integer" }			
			}
		}		
	}


}